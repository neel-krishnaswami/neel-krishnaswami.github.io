<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.36 in css mode. -->
<html>
  <head>
    <title>test7.adjs</title>
    <style type="text/css">
    <!--
      body {
        color: #ffffff;
        background-color: #2f4f4f;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #87cefa;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #00ffff;
      }
      .string {
        /* font-lock-string-face */
        color: #ffa07a;
      }
      .tuareg-font-lock-governing {
        /* tuareg-font-lock-governing-face */
        color: #ffa500;
        font-weight: bold;
      }
      .tuareg-font-lock-operator {
        /* tuareg-font-lock-operator-face */
        color: #f0e68c;
      }
      .type {
        /* font-lock-type-face */
        color: #98fb98;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #eedd82;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
  1<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">type</span><span class="type"> event </span><span class="tuareg-font-lock-operator">=</span>
  2<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Nothing
  3<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Digit <span class="keyword">of</span> num
  4<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Clear
  5<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Push
  6<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Pop
  7<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> BinOp <span class="keyword">of</span> <span class="tuareg-font-lock-operator">(</span>num <span class="tuareg-font-lock-operator">-&gt;</span> num <span class="tuareg-font-lock-operator">-&gt;</span> num<span class="tuareg-font-lock-operator">)</span>
  8<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> UnOp <span class="keyword">of</span> <span class="tuareg-font-lock-operator">(</span>num <span class="tuareg-font-lock-operator">-&gt;</span> num<span class="tuareg-font-lock-operator">)</span>
  9<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">10</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">type</span> <span class="type">state </span><span class="tuareg-font-lock-operator">:</span> <span class="type">int </span>
 11<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">state </span><span class="tuareg-font-lock-operator">=</span> list num
 12<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">13</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">type</span> <span class="type">window </span><span class="tuareg-font-lock-operator">:</span> <span class="type">lin</span>
 14<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">window </span><span class="tuareg-font-lock-operator">=</span> exists a. dom a
 15<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">16</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">type</span> <span class="type">input </span><span class="tuareg-font-lock-operator">:</span> <span class="type">int</span>
 17<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">input </span><span class="tuareg-font-lock-operator">=</span> G<span class="tuareg-font-lock-operator">(</span>window <span class="tuareg-font-lock-operator">*</span> F <span class="tuareg-font-lock-operator">(</span>stream event<span class="tuareg-font-lock-operator">))</span>
 18<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">19</span><span class="tuareg-font-lock-operator">:</span> 
 20<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span><span class="type"> </span><span class="variable-name">choose </span><span class="tuareg-font-lock-operator">:</span> event <span class="tuareg-font-lock-operator">&amp;</span> event <span class="tuareg-font-lock-operator">-&gt;</span> event
 21<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">choose</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">e1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> e2</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span>
 22<span class="tuareg-font-lock-operator">:</span>   <span class="keyword">match</span><span class="type"> e1 </span><span class="tuareg-font-lock-governing">begin</span>
 23<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Nothing <span class="tuareg-font-lock-operator">-&gt;</span> e2
 24<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> e1      <span class="tuareg-font-lock-operator">-&gt;</span> e1
 25<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">end</span>
 26<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">27</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">step </span><span class="tuareg-font-lock-operator">:</span> <span class="type">event </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> state </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> state </span>
 28<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">step</span><span class="variable-name"> e stack </span><span class="tuareg-font-lock-operator">=</span>
 29<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">pair </span><span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>e<span class="tuareg-font-lock-operator">,</span> stack<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span> 
 30<span class="tuareg-font-lock-operator">:</span>   <span class="keyword">match</span><span class="type"> pair </span><span class="tuareg-font-lock-governing">begin</span>
 31<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>Digit n<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>m<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">))</span>          <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>n <span class="tuareg-font-lock-operator">+</span> <span class="tuareg-font-lock-operator">(</span>10 <span class="tuareg-font-lock-operator">*</span> m<span class="tuareg-font-lock-operator">),</span> rest<span class="tuareg-font-lock-operator">)</span>
 32<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>Digit n<span class="tuareg-font-lock-operator">,</span> Nil<span class="tuareg-font-lock-operator">)</span>                    <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">,</span> Nil<span class="tuareg-font-lock-operator">)</span>
 33<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>Clear<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">))</span>            <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>0<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">)</span>
 34<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>Push<span class="tuareg-font-lock-operator">,</span> stack<span class="tuareg-font-lock-operator">)</span>                     <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>0<span class="tuareg-font-lock-operator">,</span> stack<span class="tuareg-font-lock-operator">)</span>
 35<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>Pop<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">))</span>              <span class="tuareg-font-lock-operator">-&gt;</span> rest
 36<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>BinOp f<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>m<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">)))</span> <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>f n m<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">)</span>
 37<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>UnOp f<span class="tuareg-font-lock-operator">,</span> Cons<span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">))</span>           <span class="tuareg-font-lock-operator">-&gt;</span> Cons<span class="tuareg-font-lock-operator">(</span>f n<span class="tuareg-font-lock-operator">,</span> rest<span class="tuareg-font-lock-operator">)</span>
 38<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span>                             <span class="tuareg-font-lock-operator">-&gt;</span> stack 
 39<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">end</span>
 40<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">41</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">states </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> state </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream event </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream state</span>
 42<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">states</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">(</span>e <span class="tuareg-font-lock-operator">::</span> es<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">=</span>
 43<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">!</span>state <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">!(</span>step e state<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span> 
 44<span class="tuareg-font-lock-operator">:</span>   <span class="type">cons</span><span class="tuareg-font-lock-operator">(</span><span class="type">u</span><span class="tuareg-font-lock-operator">,</span><span class="type"> state</span><span class="tuareg-font-lock-operator">,</span><span class="type"> states us state es</span><span class="tuareg-font-lock-operator">)</span>
 45<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">46</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">ints </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> num </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream num</span>
 47<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">ints</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> n <span class="tuareg-font-lock-operator">=</span>
 48<span class="tuareg-font-lock-operator">:</span>   <span class="type">cons</span><span class="tuareg-font-lock-operator">(</span>u<span class="tuareg-font-lock-operator">,</span> n<span class="tuareg-font-lock-operator">,</span> ints us <span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">+</span>1<span class="tuareg-font-lock-operator">))</span>
 49<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">50</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">stackToString </span><span class="tuareg-font-lock-operator">:</span> <span class="type">state </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> string</span>
 51<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">loop</span><span class="variable-name"> stackToString ns </span><span class="tuareg-font-lock-operator">=</span>
 52<span class="tuareg-font-lock-operator">:</span>   <span class="keyword">match</span><span class="type"> ns </span><span class="tuareg-font-lock-governing">begin</span>
 53<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Nil          <span class="tuareg-font-lock-operator">-&gt;</span> <span class="string">"--"</span>
 54<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Cons<span class="tuareg-font-lock-operator">(</span>n<span class="tuareg-font-lock-operator">,</span> Nil<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> toString n
 55<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-operator">|</span> Cons<span class="tuareg-font-lock-operator">(</span>m<span class="tuareg-font-lock-operator">,</span> xs<span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">-&gt;</span> cat<span class="tuareg-font-lock-operator">(</span>toString m<span class="tuareg-font-lock-operator">,</span> cat<span class="tuareg-font-lock-operator">(</span><span class="string">"  "</span><span class="tuareg-font-lock-operator">,</span> stackToString xs<span class="tuareg-font-lock-operator">))</span>
 56<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">end</span>
 57<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">58</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">map </span><span class="tuareg-font-lock-operator">:</span> <span class="type">forall a b. </span><span class="tuareg-font-lock-operator">!(</span>a <span class="tuareg-font-lock-operator">-&gt;</span> b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> stream alloc <span class="tuareg-font-lock-operator">-&gt;</span> stream a <span class="tuareg-font-lock-operator">-&gt;</span> stream b 
 59<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">map</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(!</span>f<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>x <span class="tuareg-font-lock-operator">::</span> xs<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">=</span>
 60<span class="tuareg-font-lock-operator">:</span>   <span class="type">cons</span><span class="tuareg-font-lock-operator">(</span>u<span class="tuareg-font-lock-operator">,</span> f x<span class="tuareg-font-lock-operator">,</span> map <span class="tuareg-font-lock-operator">(!</span>f<span class="tuareg-font-lock-operator">)</span> us xs<span class="tuareg-font-lock-operator">)</span>
 61<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">62</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">zip </span><span class="tuareg-font-lock-operator">:</span> <span class="type">forall a b. stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream a </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream b </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream </span><span class="tuareg-font-lock-operator">(</span>a <span class="tuareg-font-lock-operator">&amp;</span> b<span class="tuareg-font-lock-operator">)</span>
 63<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">zip</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>a <span class="tuareg-font-lock-operator">::</span> <span class="keyword">as</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>b <span class="tuareg-font-lock-operator">::</span> bs<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">=</span>
 64<span class="tuareg-font-lock-operator">:</span>   <span class="type">cons</span><span class="tuareg-font-lock-operator">(</span>u<span class="tuareg-font-lock-operator">,</span> <span class="tuareg-font-lock-operator">(</span>a<span class="tuareg-font-lock-operator">,</span>b<span class="tuareg-font-lock-operator">),</span> zip us <span class="keyword">as</span> bs<span class="tuareg-font-lock-operator">)</span>
 65<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">66</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">unfold </span><span class="tuareg-font-lock-operator">:</span> <span class="type">forall a b. </span><span class="tuareg-font-lock-operator">!(</span>alloc <span class="tuareg-font-lock-operator">-&gt;</span> a <span class="tuareg-font-lock-operator">-&gt;</span> b <span class="tuareg-font-lock-operator">&amp;</span> next a<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> stream alloc <span class="tuareg-font-lock-operator">-&gt;</span> a <span class="tuareg-font-lock-operator">-&gt;</span> stream b
 67<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">unfold</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(!</span>f<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> seed <span class="tuareg-font-lock-operator">=</span>
 68<span class="tuareg-font-lock-operator">:</span>   <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">b</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> next seed</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> f u seed <span class="tuareg-font-lock-governing">in</span>
 69<span class="tuareg-font-lock-operator">:</span>   <span class="type">cons</span><span class="tuareg-font-lock-operator">(</span>u<span class="tuareg-font-lock-operator">,</span> b<span class="tuareg-font-lock-operator">,</span> unfold <span class="tuareg-font-lock-operator">(!</span>f<span class="tuareg-font-lock-operator">)</span> us seed<span class="tuareg-font-lock-operator">)</span>
 70<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">71</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">mux </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream event </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream event </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream event</span>
 72<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">mux</span><span class="variable-name"> us es1 es2 </span><span class="tuareg-font-lock-operator">=</span> map <span class="tuareg-font-lock-operator">(!</span>choose<span class="tuareg-font-lock-operator">)</span> us <span class="tuareg-font-lock-operator">(</span>zip us es1 es2<span class="tuareg-font-lock-operator">)</span>
 73<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">74</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">button </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> string </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> event </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> input</span>
 75<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">button</span><span class="variable-name"> us label e </span><span class="tuareg-font-lock-operator">=</span>
 76<span class="tuareg-font-lock-operator">:</span>   <span class="type">G</span><span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">let</span> <span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> run mkButton <span class="tuareg-font-lock-governing">in</span>
 77<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>text label<span class="tuareg-font-lock-operator">)</span> w <span class="tuareg-font-lock-governing">in</span>
 78<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>width <span class="string">"4em"</span><span class="tuareg-font-lock-operator">)</span> w <span class="tuareg-font-lock-governing">in</span> 
 79<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F bs</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>clicks us<span class="tuareg-font-lock-operator">)</span> w <span class="tuareg-font-lock-governing">in</span>
 80<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-operator">(</span>w<span class="tuareg-font-lock-operator">,</span> F <span class="tuareg-font-lock-operator">(</span>map <span class="tuareg-font-lock-operator">(!(</span><span class="keyword">fun</span> <span class="variable-name">b </span><span class="tuareg-font-lock-operator">-&gt;</span> <span class="keyword">if</span> b <span class="keyword">then</span> e <span class="keyword">else</span> Nothing<span class="tuareg-font-lock-operator">))</span> us bs<span class="tuareg-font-lock-operator">)))</span>
 81<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">82</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">numeric </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> num </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> input</span>
 83<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">numeric</span><span class="variable-name"> us n </span><span class="tuareg-font-lock-operator">=</span> button us <span class="tuareg-font-lock-operator">(</span>toString n<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>Digit n<span class="tuareg-font-lock-operator">)</span>
 84<span class="tuareg-font-lock-operator">:</span> 
 <span class="type">85</span><span class="tuareg-font-lock-operator">:</span> 
 86<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span><span class="type"> </span><span class="variable-name">panel </span><span class="tuareg-font-lock-operator">:</span> stream alloc <span class="tuareg-font-lock-operator">-&gt;</span> G window <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>input <span class="tuareg-font-lock-operator">&amp;</span> input <span class="tuareg-font-lock-operator">&amp;</span> input <span class="tuareg-font-lock-operator">&amp;</span> input<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> input
 87<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">panel</span><span class="variable-name"> us mkBox </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">b1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> b2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> b3</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> b4</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span>
 88<span class="tuareg-font-lock-operator">:</span>   <span class="type">G</span><span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">let</span> <span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run mkBox <span class="tuareg-font-lock-governing">in</span>
 89<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w1</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F es1</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run b1 <span class="tuareg-font-lock-governing">in</span>
 90<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w2</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F es2</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run b2 <span class="tuareg-font-lock-governing">in</span>
 91<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w3</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F es3</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run b3 <span class="tuareg-font-lock-governing">in</span>
 92<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w4</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F es4</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run b4 <span class="tuareg-font-lock-governing">in</span>
 93<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> w1<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
 94<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> w2<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
 95<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> w3<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
 96<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> w4<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
 97<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> F <span class="tuareg-font-lock-operator">(</span>mux us es1 <span class="tuareg-font-lock-operator">(</span>mux us es2 <span class="tuareg-font-lock-operator">(</span>mux us es3 es4<span class="tuareg-font-lock-operator">)))))</span>
 98<span class="tuareg-font-lock-operator">:</span>  
 <span class="type">99</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">inputPanel </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> input</span>
100<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">inputPanel</span><span class="variable-name"> us </span><span class="tuareg-font-lock-operator">=</span>
101<span class="tuareg-font-lock-operator">:</span>   <span class="type">panel us vbox </span><span class="tuareg-font-lock-operator">(</span>panel us hbox <span class="tuareg-font-lock-operator">(</span>numeric us 7<span class="tuareg-font-lock-operator">,</span>
102<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 8</span><span class="tuareg-font-lock-operator">,</span>
103<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 9</span><span class="tuareg-font-lock-operator">,</span>
104<span class="tuareg-font-lock-operator">:</span>                               <span class="type">button us </span><span class="string">"x"</span> <span class="tuareg-font-lock-operator">(</span>BinOp <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">a b </span><span class="tuareg-font-lock-operator">-&gt;</span> a <span class="tuareg-font-lock-operator">*</span> b<span class="tuareg-font-lock-operator">))),</span>
105<span class="tuareg-font-lock-operator">:</span>                 <span class="type">panel us hbox </span><span class="tuareg-font-lock-operator">(</span>numeric us 4<span class="tuareg-font-lock-operator">,</span>
106<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 5</span><span class="tuareg-font-lock-operator">,</span>
107<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 6</span><span class="tuareg-font-lock-operator">,</span>
108<span class="tuareg-font-lock-operator">:</span>                               <span class="type">button us </span><span class="string">"+"</span> <span class="tuareg-font-lock-operator">(</span>BinOp <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">a b </span><span class="tuareg-font-lock-operator">-&gt;</span> a <span class="tuareg-font-lock-operator">+</span> b<span class="tuareg-font-lock-operator">))),</span>
109<span class="tuareg-font-lock-operator">:</span>                 <span class="type">panel us hbox </span><span class="tuareg-font-lock-operator">(</span>numeric us 1<span class="tuareg-font-lock-operator">,</span>
110<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 2</span><span class="tuareg-font-lock-operator">,</span>
111<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 3</span><span class="tuareg-font-lock-operator">,</span>
112<span class="tuareg-font-lock-operator">:</span>                               <span class="type">button us </span><span class="string">"Pop"</span> <span class="tuareg-font-lock-operator">(</span>Pop<span class="tuareg-font-lock-operator">)),</span>
113<span class="tuareg-font-lock-operator">:</span>                 <span class="type">panel us hbox </span><span class="tuareg-font-lock-operator">(</span>button us <span class="string">"+/-"</span> <span class="tuareg-font-lock-operator">(</span>UnOp <span class="tuareg-font-lock-operator">(</span><span class="keyword">fun</span> <span class="variable-name">n </span><span class="tuareg-font-lock-operator">-&gt;</span> 0 <span class="tuareg-font-lock-operator">-</span> n<span class="tuareg-font-lock-operator">)),</span>
114<span class="tuareg-font-lock-operator">:</span>                               <span class="type">numeric us 0</span><span class="tuareg-font-lock-operator">,</span>
115<span class="tuareg-font-lock-operator">:</span>                               <span class="type">button us </span><span class="string">"C"</span> <span class="tuareg-font-lock-operator">(</span>Clear<span class="tuareg-font-lock-operator">),</span>
116<span class="tuareg-font-lock-operator">:</span>                               <span class="type">button us </span><span class="string">"Push"</span> <span class="tuareg-font-lock-operator">(</span>Push<span class="tuareg-font-lock-operator">)))</span>
117<span class="tuareg-font-lock-operator">:</span> 
<span class="type">118</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">dynlabel </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> stream string </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> G window</span>
119<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">dynlabel</span><span class="variable-name"> us ss </span><span class="tuareg-font-lock-operator">=</span>
120<span class="tuareg-font-lock-operator">:</span>   <span class="type">G</span><span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">val</span> <span class="variable-name">displayText </span><span class="tuareg-font-lock-operator">:</span> <span class="type">forall a. </span><span class="tuareg-font-lock-operator">(</span>F <span class="tuareg-font-lock-operator">(</span>stream alloc<span class="tuareg-font-lock-operator">))</span> <span class="tuareg-font-lock-operator">-</span>o F <span class="tuareg-font-lock-operator">(</span>stream string<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-</span>o dom a <span class="tuareg-font-lock-operator">-</span>o dom a
121<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="tuareg-font-lock-governing">rec</span><span class="type"> </span><span class="function-name">displayText</span><span class="variable-name"> F</span><span class="tuareg-font-lock-operator">(</span>u <span class="tuareg-font-lock-operator">::</span> us<span class="tuareg-font-lock-operator">)</span> F<span class="tuareg-font-lock-operator">(</span>s <span class="tuareg-font-lock-operator">::</span> ss<span class="tuareg-font-lock-operator">)</span> w <span class="tuareg-font-lock-operator">=</span>
122<span class="tuareg-font-lock-operator">:</span>       <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>text s<span class="tuareg-font-lock-operator">)</span> w <span class="tuareg-font-lock-governing">in</span>
123<span class="tuareg-font-lock-operator">:</span>       <span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">w0</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> next w1</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run split w <span class="tuareg-font-lock-governing">in</span>
124<span class="tuareg-font-lock-operator">:</span>       <span class="type">run merge </span><span class="tuareg-font-lock-operator">(</span>w0<span class="tuareg-font-lock-operator">,</span> next<span class="tuareg-font-lock-operator">(</span>displayText <span class="tuareg-font-lock-operator">(</span>F us<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">(</span>F ss<span class="tuareg-font-lock-operator">)</span> w1<span class="tuareg-font-lock-operator">,</span> u<span class="tuareg-font-lock-operator">))</span>
125<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">in</span>
126<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">w </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>mkText <span class="string">""</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span> 
127<span class="tuareg-font-lock-operator">:</span>     <span class="type">displayText </span><span class="tuareg-font-lock-operator">(</span><span class="type">F us</span><span class="tuareg-font-lock-operator">)</span><span class="type"> </span><span class="tuareg-font-lock-operator">(</span><span class="type">F ss</span><span class="tuareg-font-lock-operator">)</span><span class="type"> w</span><span class="tuareg-font-lock-operator">)</span>
128<span class="tuareg-font-lock-operator">:</span>     
<span class="type">129</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">val</span> <span class="variable-name">main </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream alloc </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> G window</span>
130<span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="function-name">main</span><span class="variable-name"> us </span><span class="tuareg-font-lock-operator">=</span>
131<span class="tuareg-font-lock-operator">:</span>   <span class="type">G</span><span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">let</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">wpanel</span><span class="tuareg-font-lock-operator">,</span><span class="variable-name"> F events</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>inputPanel us<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
132<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">wdisplay </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">((</span><span class="tuareg-font-lock-governing">let</span> <span class="variable-name">events </span><span class="tuareg-font-lock-operator">:</span> <span class="type">stream state </span><span class="tuareg-font-lock-operator">=</span> states us <span class="tuareg-font-lock-operator">(</span>Nil<span class="tuareg-font-lock-operator">)</span> events <span class="tuareg-font-lock-governing">in</span>
133<span class="tuareg-font-lock-operator">:</span>                          <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">labels </span><span class="tuareg-font-lock-operator">:</span> stream string <span class="tuareg-font-lock-operator">=</span> map <span class="tuareg-font-lock-operator">(!</span>stackToString<span class="tuareg-font-lock-operator">)</span> us events <span class="tuareg-font-lock-governing">in</span>
134<span class="tuareg-font-lock-operator">:</span>                          <span class="type">dynlabel us labels</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> <span class="type">G window</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
135<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">wdisplay </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>backgroundColor <span class="string">"rgb(60,60,60)"</span><span class="tuareg-font-lock-operator">)</span> wdisplay <span class="tuareg-font-lock-governing">in</span>
136<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">wdisplay </span><span class="tuareg-font-lock-operator">=</span> run <span class="tuareg-font-lock-operator">(</span>fontFamily <span class="string">"monospace"</span><span class="tuareg-font-lock-operator">)</span> wdisplay <span class="tuareg-font-lock-governing">in</span>
137<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run vbox <span class="tuareg-font-lock-governing">in</span>
138<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> wdisplay<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
139<span class="tuareg-font-lock-operator">:</span>     <span class="tuareg-font-lock-governing">let</span><span class="type"> </span><span class="variable-name">box </span><span class="tuareg-font-lock-operator">=</span> run attach <span class="tuareg-font-lock-operator">(</span>box<span class="tuareg-font-lock-operator">,</span> wpanel<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-governing">in</span>
140<span class="tuareg-font-lock-operator">:</span>     <span class="type">box</span><span class="tuareg-font-lock-operator">)</span>
141<span class="tuareg-font-lock-operator">:</span> 
<span class="type">142</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">in</span> main 
</pre>
  </body>
</html>
